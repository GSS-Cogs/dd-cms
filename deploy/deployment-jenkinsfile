pipeline {
    agent any
    environment {
        GIT_COMMIT_SHORT = sh(
                script: "printf \$(git rev-parse --short ${GIT_COMMIT})",
                returnStdout: true
        )
    }
    stages {
        stage('build') {
            steps {
                dir('deploy') {
                    sh "docker-compose build _plone_builder _volto_builder"
                }
            }
        }
        stage('run') {
            steps {
                dir('deploy') {
                      sh "docker-compose up -d plone-cc2 volto-v2 plone-vawag volto-vawag"
                }
            }
        }
    }
}