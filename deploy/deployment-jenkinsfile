pipeline {
    agent any
    stages {
        stage('build') {
            environment {
                GIT_COMMIT_SHORT = sh(
                        script: "printf \$(git rev-parse --short ${GIT_COMMIT})",
                        returnStdout: true
                )
            }
            steps {
                dir('deploy') {
                    sh "docker-compose build plone-cc2 volto-v2 plone-vawag volto-vawag"
                }
            }
        }
        stage('run') {
            steps {
                dir('deploy') {
                      sh "docker-compose up -d plone-cc2 volto-v2 plone-vawag volto-vawag"
                }
            }
        }
    }
}