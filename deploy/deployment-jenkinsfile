pipeline {
    agent any
    environment {
        GIT_COMMIT_SHORT = sh(
                script: "printf \$(git rev-parse --short ${GIT_COMMIT})",
                returnStdout: true
        )
        DB = credentials('staging-postgres')
    }
    stages {
        stage('build') {
            steps {
                dir('deploy') {
                    sh "docker-compose build db _plone_builder _volto_builder"
                }
            }
        }
        stage('run') {
            steps {
                dir('deploy') {
                      sh "docker-compose up -d db plone volto"
                }
            }
        }
    }
}
